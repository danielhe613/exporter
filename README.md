
[TOC]

## Functionality

### Basic Functionalities

1. acts as a remote write utility to receive the metric time series callbacks from Prometheus server, 
2. converts them into OpenTSDB import format, 
3. writes the time series into a file and compresses the file when timeout or indicated time series number is reached.

### Management 
1. To change the goroutine number for file writing.
2. Gracefully shutdown to make sure the files are properlly written.

### Monitoring
To Monitor
1. the length of any channels in system.
2. number of file writing goroutine or all goroutines in program.

## Design 
### OpenTSDB import format
The format is the same as the Telnet put interface.
Each data point per line in a text file. 
(could be compressed with Gzip, and compressed file must end with .gz extension.)

    <metric> <timestamp> <value> <tagk=tagv> [<tagkN=tagvN>]

Where:
metric Is the name of the metric. Note that the metric name may not include spaces.
timestamp Is the absolute timestamp of the data point in seconds or milliseconds
value Is the value to store
tagk=tagv Is a pair of one or more space sparate tag name and value pairs. Note that the tags may not have spaces in them.


Example:

    sys.cpu.user 1356998400 42 host=web01 cpu=0

### Exported data file naming rule

    <roomname>_<timestamp>_<seqno>.txt   (temporary intermediate data file)
	<roomname>_<timestamp>_<seqno>.gz    (the exported files to upload) 
	
Where:
Both seqno and timestamp are generated by aggregator goroutine and sent to filewriter goroutines.
roomname is from the program arguments in this release, and may be changed in the future releases.

### Gzip
Gzip should be installed on the host and executed by the account to launch this program.
The filewriter goroutine will launch gzip to compress the exported .txt data files.


	